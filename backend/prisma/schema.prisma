// Prisma Schema for CCFVS
// Clean Architecture with UUID primary keys

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Building Entity
model Building {
  id          String   @id @default(uuid()) @db.Uuid
  name        String   @unique @db.VarChar(255)
  description String?  @db.Text
  floors      Floor[]
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  @@map("buildings")
  @@index([name])
}

// Floor Entity
model Floor {
  id           String   @id @default(uuid()) @db.Uuid
  buildingId   String   @map("building_id") @db.Uuid
  floorNumber  Int      @map("floor_number")
  mapData      Json?    @map("map_data")
  building     Building @relation(fields: [buildingId], references: [id], onDelete: Cascade)
  rooms        Room[]
  createdAt    DateTime @default(now()) @map("created_at")
  updatedAt    DateTime @updatedAt @map("updated_at")

  @@unique([buildingId, floorNumber])
  @@map("floors")
  @@index([buildingId])
}

// Room Entity
model Room {
  id          String     @id @default(uuid()) @db.Uuid
  floorId     String     @map("floor_id") @db.Uuid
  roomNumber  String     @map("room_number") @db.VarChar(50)
  type        RoomType
  capacity    Int
  coordinates Json?
  equipment   String[]   @default([])
  floor       Floor      @relation(fields: [floorId], references: [id], onDelete: Cascade)
  schedules   Schedule[]
  createdAt   DateTime   @default(now()) @map("created_at")
  updatedAt   DateTime   @updatedAt @map("updated_at")

  @@unique([floorId, roomNumber])
  @@map("rooms")
  @@index([floorId])
  @@index([type])
  @@index([capacity])
}

// Schedule Entity
model Schedule {
  id        String   @id @default(uuid()) @db.Uuid
  roomId    String   @map("room_id") @db.Uuid
  className String   @map("class_name") @db.VarChar(255)
  bookedBy  String   @map("booked_by") @db.VarChar(255)
  startTime DateTime @map("start_time")
  endTime   DateTime @map("end_time")
  room      Room     @relation(fields: [roomId], references: [id], onDelete: Cascade)
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("schedules")
  @@index([roomId])
  @@index([startTime, endTime])
}

// Import Log Entity
model ImportLog {
  id         String   @id @default(uuid()) @db.Uuid
  fileName   String   @map("file_name") @db.VarChar(255)
  totalRows  Int      @map("total_rows")
  errorCount Int      @map("error_count")
  errors     Json?
  status     String   @db.VarChar(50)
  createdAt  DateTime @default(now()) @map("created_at")

  @@map("import_logs")
  @@index([createdAt])
}

// User Entity (for authentication)
model User {
  id        String   @id @default(uuid()) @db.Uuid
  email     String   @unique @db.VarChar(255)
  password  String   @db.VarChar(255)
  name      String   @db.VarChar(255)
  role      UserRole @default(USER)
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("users")
  @@index([email])
}

// Enums
enum RoomType {
  CLASSROOM
  CONFERENCE
  LAB
  OFFICE
  AUDITORIUM
  LIBRARY
  OTHER
}

enum UserRole {
  ADMIN
  USER
}
